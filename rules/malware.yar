/*
 * Malware signatures and indicators
 * Detects known malware families and malicious patterns
 */

rule Malware_Generic_Backdoor {
    meta:
        description = "Detects generic backdoor indicators"
        severity = "high"
        category = "malware"
    strings:
        $bd1 = "backdoor" ascii nocase
        $bd2 = "rootkit" ascii nocase
        $bd3 = "keylogger" ascii nocase
        $bd4 = "RAT" ascii
        $bd5 = "remote access" ascii nocase
        $cmd1 = "shell_exec" ascii
        $cmd2 = "exec(" ascii
        $cmd3 = "system(" ascii
        $cmd4 = "popen(" ascii
    condition:
        any of ($bd*) or 2 of ($cmd*)
}

rule Malware_Stealer_Indicators {
    meta:
        description = "Detects information stealer patterns"
        severity = "high"
        category = "malware"
    strings:
        // Browser data theft
        $br1 = "\\Google\\Chrome\\User Data" ascii nocase
        $br2 = "\\Mozilla\\Firefox\\Profiles" ascii nocase
        $br3 = "\\Microsoft\\Edge\\User Data" ascii nocase
        $br4 = "Login Data" ascii
        $br5 = "cookies.sqlite" ascii
        // Credential files
        $cred1 = "\\Credentials\\" ascii
        $cred2 = "wallet.dat" ascii
        $cred3 = ".ssh\\id_rsa" ascii
        $cred4 = "\\FileZilla\\recentservers.xml" ascii
    condition:
        2 of them
}

rule Malware_Dropper_Indicators {
    meta:
        description = "Detects dropper/downloader behavior"
        severity = "high"
        category = "malware"
    strings:
        $drop1 = "URLDownloadToFile" ascii
        $drop2 = "InternetReadFile" ascii
        $drop3 = "HttpSendRequest" ascii
        $exec1 = "WinExec" ascii
        $exec2 = "ShellExecute" ascii
        $exec3 = "CreateProcess" ascii
        $tmp1 = "%TEMP%" ascii
        $tmp2 = "\\Temp\\" ascii nocase
        $tmp3 = "/tmp/" ascii
    condition:
        (any of ($drop*)) and (any of ($exec*) or any of ($tmp*))
}

rule Malware_Webshell {
    meta:
        description = "Detects web shell patterns"
        severity = "high"
        category = "malware"
    strings:
        $ws1 = "c99shell" ascii nocase
        $ws2 = "r57shell" ascii nocase
        $ws3 = "webshell" ascii nocase
        $ws4 = "phpspy" ascii nocase
        $ws5 = "b374k" ascii nocase
        $eval1 = "eval($_" ascii
        $eval2 = "assert($_" ascii
        $eval3 = "preg_replace" ascii
        $eval4 = "base64_decode($_" ascii
    condition:
        any of ($ws*) or any of ($eval*)
}

rule Malware_NPM_Specific {
    meta:
        description = "Detects npm-specific malware patterns"
        severity = "high"
        category = "malware"
    strings:
        // Known malicious npm package patterns
        $npm1 = "preinstall" ascii
        $npm2 = "postinstall" ascii
        $exfil1 = "/etc/passwd" ascii
        $exfil2 = "process.env" ascii
        $exfil3 = "os.homedir" ascii
        $exfil4 = "npm_config" ascii nocase
        $net1 = "http.request" ascii
        $net2 = "https.request" ascii
        $net3 = "webhook" ascii nocase
        $net4 = "discord" ascii nocase
    condition:
        ($npm1 or $npm2) and (any of ($exfil*)) and (any of ($net*))
}

